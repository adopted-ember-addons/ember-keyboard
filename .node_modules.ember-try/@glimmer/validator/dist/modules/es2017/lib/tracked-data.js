import { tagFor, dirtyTagFor } from './meta';
import { consumeTag } from './tracking';
export function trackedData(key, initializer) {
  let values = new WeakMap();
  let hasInitializer = typeof initializer === 'function';

  function getter(self) {
    consumeTag(tagFor(self, key));
    let value; // If the field has never been initialized, we should initialize it

    if (hasInitializer && !values.has(self)) {
      value = initializer.call(self);
      values.set(self, value);
    } else {
      value = values.get(self);
    }

    return value;
  }

  function setter(self, value) {
    dirtyTagFor(self, key);
    values.set(self, value);
  }

  return {
    getter,
    setter
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3ZhbGlkYXRvci9saWIvdHJhY2tlZC1kYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFNBQVMsTUFBVCxFQUFpQixXQUFqQixRQUFvQyxRQUFwQztBQUNBLFNBQVMsVUFBVCxRQUEyQixZQUEzQjtBQUtBLE9BQU0sU0FBVSxXQUFWLENBQ0osR0FESSxFQUVKLFdBRkksRUFFMkI7QUFFL0IsTUFBSSxNQUFNLEdBQUcsSUFBSSxPQUFKLEVBQWI7QUFDQSxNQUFJLGNBQWMsR0FBRyxPQUFPLFdBQVAsS0FBdUIsVUFBNUM7O0FBRUEsV0FBUyxNQUFULENBQWdCLElBQWhCLEVBQXVCO0FBQ3JCLElBQUEsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFELEVBQU8sR0FBUCxDQUFQLENBQVY7QUFFQSxRQUFJLEtBQUosQ0FIcUIsQ0FLckI7O0FBQ0EsUUFBSSxjQUFjLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBUCxDQUFXLElBQVgsQ0FBdkIsRUFBeUM7QUFDdkMsTUFBQSxLQUFLLEdBQUcsV0FBWSxDQUFDLElBQWIsQ0FBa0IsSUFBbEIsQ0FBUjtBQUNBLE1BQUEsTUFBTSxDQUFDLEdBQVAsQ0FBVyxJQUFYLEVBQWlCLEtBQWpCO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsTUFBQSxLQUFLLEdBQUcsTUFBTSxDQUFDLEdBQVAsQ0FBVyxJQUFYLENBQVI7QUFDRDs7QUFFRCxXQUFPLEtBQVA7QUFDRDs7QUFFRCxXQUFTLE1BQVQsQ0FBZ0IsSUFBaEIsRUFBeUIsS0FBekIsRUFBb0M7QUFDbEMsSUFBQSxXQUFXLENBQUMsSUFBRCxFQUFPLEdBQVAsQ0FBWDtBQUNBLElBQUEsTUFBTSxDQUFDLEdBQVAsQ0FBVyxJQUFYLEVBQWlCLEtBQWpCO0FBQ0Q7O0FBRUQsU0FBTztBQUFFLElBQUEsTUFBRjtBQUFVLElBQUE7QUFBVixHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0YWdGb3IsIGRpcnR5VGFnRm9yIH0gZnJvbSAnLi9tZXRhJztcbmltcG9ydCB7IGNvbnN1bWVUYWcgfSBmcm9tICcuL3RyYWNraW5nJztcblxuZXhwb3J0IHR5cGUgR2V0dGVyPFQsIEsgZXh0ZW5kcyBrZXlvZiBUPiA9IChzZWxmOiBUKSA9PiBUW0tdIHwgdW5kZWZpbmVkO1xuZXhwb3J0IHR5cGUgU2V0dGVyPFQsIEsgZXh0ZW5kcyBrZXlvZiBUPiA9IChzZWxmOiBULCB2YWx1ZTogVFtLXSkgPT4gdm9pZDtcblxuZXhwb3J0IGZ1bmN0aW9uIHRyYWNrZWREYXRhPFQgZXh0ZW5kcyBvYmplY3QsIEsgZXh0ZW5kcyBrZXlvZiBUPihcbiAga2V5OiBLLFxuICBpbml0aWFsaXplcj86ICh0aGlzOiBUKSA9PiBUW0tdXG4pOiB7IGdldHRlcjogR2V0dGVyPFQsIEs+OyBzZXR0ZXI6IFNldHRlcjxULCBLPiB9IHtcbiAgbGV0IHZhbHVlcyA9IG5ldyBXZWFrTWFwPFQsIFRbS10+KCk7XG4gIGxldCBoYXNJbml0aWFsaXplciA9IHR5cGVvZiBpbml0aWFsaXplciA9PT0gJ2Z1bmN0aW9uJztcblxuICBmdW5jdGlvbiBnZXR0ZXIoc2VsZjogVCkge1xuICAgIGNvbnN1bWVUYWcodGFnRm9yKHNlbGYsIGtleSkpO1xuXG4gICAgbGV0IHZhbHVlO1xuXG4gICAgLy8gSWYgdGhlIGZpZWxkIGhhcyBuZXZlciBiZWVuIGluaXRpYWxpemVkLCB3ZSBzaG91bGQgaW5pdGlhbGl6ZSBpdFxuICAgIGlmIChoYXNJbml0aWFsaXplciAmJiAhdmFsdWVzLmhhcyhzZWxmKSkge1xuICAgICAgdmFsdWUgPSBpbml0aWFsaXplciEuY2FsbChzZWxmKTtcbiAgICAgIHZhbHVlcy5zZXQoc2VsZiwgdmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlcy5nZXQoc2VsZik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0dGVyKHNlbGY6IFQsIHZhbHVlOiBUW0tdKTogdm9pZCB7XG4gICAgZGlydHlUYWdGb3Ioc2VsZiwga2V5KTtcbiAgICB2YWx1ZXMuc2V0KHNlbGYsIHZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB7IGdldHRlciwgc2V0dGVyIH07XG59XG4iXSwic291cmNlUm9vdCI6IiJ9