"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isLocSexp = isLocSexp;
exports.isParamsSexp = isParamsSexp;
exports.isHashSexp = isHashSexp;
exports.normalizeModifier = normalizeModifier;
exports.normalizeAttr = normalizeAttr;
exports.normalizeHash = normalizeHash;
exports.normalizeHead = normalizeHead;
exports.normalizeElementOptions = normalizeElementOptions;
exports.default = exports.SYNTHETIC = void 0;

var _util = require("@glimmer/util");

function buildMustache(path, params, hash, raw, loc, strip) {
  if (typeof path === 'string') {
    path = buildHead(path);
  }

  return {
    type: 'MustacheStatement',
    path,
    params: params || [],
    hash: hash || buildHash([]),
    escaped: !raw,
    loc: buildLoc(loc || null),
    strip: strip || {
      open: false,
      close: false
    }
  };
}

function buildBlock(path, params, hash, _defaultBlock, _elseBlock, loc, openStrip, inverseStrip, closeStrip) {
  let defaultBlock;
  let elseBlock;

  if (_defaultBlock.type === 'Template') {
    if (false
    /* LOCAL_DEBUG */
    ) {
        false && !false && (0, _util.deprecate)(`b.program is deprecated. Use b.blockItself instead.`);
      }

    defaultBlock = (0, _util.assign)({}, _defaultBlock, {
      type: 'Block'
    });
  } else {
    defaultBlock = _defaultBlock;
  }

  if (_elseBlock !== undefined && _elseBlock !== null && _elseBlock.type === 'Template') {
    if (false
    /* LOCAL_DEBUG */
    ) {
        false && !false && (0, _util.deprecate)(`b.program is deprecated. Use b.blockItself instead.`);
      }

    elseBlock = (0, _util.assign)({}, _elseBlock, {
      type: 'Block'
    });
  } else {
    elseBlock = _elseBlock;
  }

  return {
    type: 'BlockStatement',
    path: buildHead(path),
    params: params || [],
    hash: hash || buildHash([]),
    program: defaultBlock || null,
    inverse: elseBlock || null,
    loc: buildLoc(loc || null),
    openStrip: openStrip || {
      open: false,
      close: false
    },
    inverseStrip: inverseStrip || {
      open: false,
      close: false
    },
    closeStrip: closeStrip || {
      open: false,
      close: false
    }
  };
}

function buildElementModifier(path, params, hash, loc) {
  return {
    type: 'ElementModifierStatement',
    path: buildHead(path),
    params: params || [],
    hash: hash || buildHash([]),
    loc: buildLoc(loc || null)
  };
}

function buildPartial(name, params, hash, indent, loc) {
  return {
    type: 'PartialStatement',
    name: name,
    params: params || [],
    hash: hash || buildHash([]),
    indent: indent || '',
    strip: {
      open: false,
      close: false
    },
    loc: buildLoc(loc || null)
  };
}

function buildComment(value, loc) {
  return {
    type: 'CommentStatement',
    value: value,
    loc: buildLoc(loc || null)
  };
}

function buildMustacheComment(value, loc) {
  return {
    type: 'MustacheCommentStatement',
    value: value,
    loc: buildLoc(loc || null)
  };
}

function buildConcat(parts, loc) {
  return {
    type: 'ConcatStatement',
    parts: parts || [],
    loc: buildLoc(loc || null)
  };
}

function isLocSexp(value) {
  return Array.isArray(value) && value.length === 2 && value[0] === 'loc';
}

function isParamsSexp(value) {
  return Array.isArray(value) && !isLocSexp(value);
}

function isHashSexp(value) {
  if (typeof value === 'object' && value && !Array.isArray(value)) {
    expectType(value);
    return true;
  } else {
    return false;
  }
}

function expectType(_input) {
  return;
}

function normalizeModifier(sexp) {
  if (typeof sexp === 'string') {
    return buildElementModifier(sexp);
  }

  let path = normalizeHead(sexp[0]);
  let params;
  let hash;
  let loc = null;
  let parts = sexp.slice(1);
  let next = parts.shift();

  _process: {
    if (isParamsSexp(next)) {
      params = next;
    } else {
      break _process;
    }

    next = parts.shift();

    if (isHashSexp(next)) {
      hash = normalizeHash(next);
    } else {
      break _process;
    }
  }

  if (isLocSexp(next)) {
    loc = next[1];
  }

  return {
    type: 'ElementModifierStatement',
    path,
    params: params || [],
    hash: hash || buildHash([]),
    loc: buildLoc(loc || null)
  };
}

function normalizeAttr(sexp) {
  let name = sexp[0];
  let value;

  if (typeof sexp[1] === 'string') {
    value = buildText(sexp[1]);
  } else {
    value = sexp[1];
  }

  let loc = sexp[2] ? sexp[2][1] : undefined;
  return buildAttr(name, value, loc);
}

function normalizeHash(hash, loc) {
  let pairs = [];
  Object.keys(hash).forEach(key => {
    pairs.push(buildPair(key, hash[key]));
  });
  return buildHash(pairs, loc);
}

function normalizeHead(path) {
  if (typeof path === 'string') {
    return buildHead(path);
  } else {
    return buildHead(path[1], path[2] && path[2][1]);
  }
}

function normalizeElementOptions(...args) {
  let out = {};

  for (let arg of args) {
    switch (arg[0]) {
      case 'attrs':
        {
          let [, ...rest] = arg;
          out.attrs = rest.map(normalizeAttr);
          break;
        }

      case 'modifiers':
        {
          let [, ...rest] = arg;
          out.modifiers = rest.map(normalizeModifier);
          break;
        }

      case 'body':
        {
          let [, ...rest] = arg;
          out.children = rest;
          break;
        }

      case 'comments':
        {
          let [, ...rest] = arg;
          out.comments = rest;
          break;
        }

      case 'as':
        {
          let [, ...rest] = arg;
          out.blockParams = rest;
          break;
        }

      case 'loc':
        {
          let [, rest] = arg;
          out.loc = rest;
          break;
        }
    }
  }

  return out;
}

function buildElement(tag, options, ...rest) {
  let normalized;

  if (Array.isArray(options)) {
    normalized = normalizeElementOptions(options, ...rest);
  } else {
    normalized = options || {};
  }

  let {
    attrs,
    blockParams,
    modifiers,
    comments,
    children,
    loc
  } = normalized; // this is used for backwards compat, prior to `selfClosing` being part of the ElementNode AST

  let selfClosing = false;

  if (typeof tag === 'object') {
    selfClosing = tag.selfClosing;
    tag = tag.name;
  } else {
    if (tag.slice(-1) === '/') {
      tag = tag.slice(0, -1);
      selfClosing = true;
    }
  }

  return {
    type: 'ElementNode',
    tag: tag || '',
    selfClosing: selfClosing,
    attributes: attrs || [],
    blockParams: blockParams || [],
    modifiers: modifiers || [],
    comments: comments || [],
    children: children || [],
    loc: buildLoc(loc || null)
  };
}

function buildAttr(name, value, loc) {
  return {
    type: 'AttrNode',
    name: name,
    value: value,
    loc: buildLoc(loc || null)
  };
}

function buildText(chars, loc) {
  return {
    type: 'TextNode',
    chars: chars || '',
    loc: buildLoc(loc || null)
  };
} // Expressions


function buildSexpr(path, params, hash, loc) {
  return {
    type: 'SubExpression',
    path: buildHead(path),
    params: params || [],
    hash: hash || buildHash([]),
    loc: buildLoc(loc || null)
  };
}

function buildHead(original, loc) {
  if (typeof original !== 'string') return original;
  let parts = original.split('.');
  let thisHead = false;

  if (parts[0] === 'this') {
    thisHead = true;
    parts = parts.slice(1);
  }

  return {
    type: 'PathExpression',
    original,
    this: thisHead,
    parts,
    data: false,
    loc: buildLoc(loc || null)
  };
}

function buildLiteral(type, value, loc) {
  return {
    type,
    value,
    original: value,
    loc: buildLoc(loc || null)
  };
} // Miscellaneous


function buildHash(pairs, loc) {
  return {
    type: 'Hash',
    pairs: pairs || [],
    loc: buildLoc(loc || null)
  };
}

function buildPair(key, value, loc) {
  return {
    type: 'HashPair',
    key: key,
    value,
    loc: buildLoc(loc || null)
  };
}

function buildProgram(body, blockParams, loc) {
  return {
    type: 'Template',
    body: body || [],
    blockParams: blockParams || [],
    loc: buildLoc(loc || null)
  };
}

function buildBlockItself(body, blockParams, chained = false, loc) {
  return {
    type: 'Block',
    body: body || [],
    blockParams: blockParams || [],
    chained,
    loc: buildLoc(loc || null)
  };
}

function buildTemplate(body, blockParams, loc) {
  return {
    type: 'Template',
    body: body || [],
    blockParams: blockParams || [],
    loc: buildLoc(loc || null)
  };
}

function buildSource(source) {
  return source || null;
}

function buildPosition(line, column) {
  return {
    line,
    column
  };
}

const SYNTHETIC = {
  source: '(synthetic)',
  start: {
    line: 1,
    column: 0
  },
  end: {
    line: 1,
    column: 0
  }
};
exports.SYNTHETIC = SYNTHETIC;

function buildLoc(...args) {
  if (args.length === 1) {
    let loc = args[0];

    if (loc && typeof loc === 'object') {
      return {
        source: buildSource(loc.source),
        start: buildPosition(loc.start.line, loc.start.column),
        end: buildPosition(loc.end.line, loc.end.column)
      };
    } else {
      return SYNTHETIC;
    }
  } else {
    let [startLine, startColumn, endLine, endColumn, source] = args;
    return {
      source: buildSource(source),
      start: buildPosition(startLine, startColumn),
      end: buildPosition(endLine, endColumn)
    };
  }
}

var _default = {
  mustache: buildMustache,
  block: buildBlock,
  partial: buildPartial,
  comment: buildComment,
  mustacheComment: buildMustacheComment,
  element: buildElement,
  elementModifier: buildElementModifier,
  attr: buildAttr,
  text: buildText,
  sexpr: buildSexpr,
  path: buildHead,
  concat: buildConcat,
  hash: buildHash,
  pair: buildPair,
  literal: buildLiteral,
  program: buildProgram,
  blockItself: buildBlockItself,
  template: buildTemplate,
  loc: buildLoc,
  pos: buildPosition,
  string: literal('StringLiteral'),
  boolean: literal('BooleanLiteral'),
  number: literal('NumberLiteral'),

  undefined() {
    return buildLiteral('UndefinedLiteral', undefined);
  },

  null() {
    return buildLiteral('NullLiteral', null);
  }

};
exports.default = _default;

function literal(type) {
  return function (value) {
    return buildLiteral(type, value);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvYnVpbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBU0EsU0FBQSxhQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBTXdCO0FBRXRCLE1BQUksT0FBQSxJQUFBLEtBQUosUUFBQSxFQUE4QjtBQUM1QixJQUFBLElBQUksR0FBRyxTQUFTLENBQWhCLElBQWdCLENBQWhCO0FBQ0Q7O0FBRUQsU0FBTztBQUNMLElBQUEsSUFBSSxFQURDLG1CQUFBO0FBQUEsSUFBQSxJQUFBO0FBR0wsSUFBQSxNQUFNLEVBQUUsTUFBTSxJQUhULEVBQUE7QUFJTCxJQUFBLElBQUksRUFBRSxJQUFJLElBQUksU0FBUyxDQUpsQixFQUlrQixDQUpsQjtBQUtMLElBQUEsT0FBTyxFQUFFLENBTEosR0FBQTtBQU1MLElBQUEsR0FBRyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBTlosSUFNUSxDQU5SO0FBT0wsSUFBQSxLQUFLLEVBQUUsS0FBSyxJQUFJO0FBQUUsTUFBQSxJQUFJLEVBQU4sS0FBQTtBQUFlLE1BQUEsS0FBSyxFQUFFO0FBQXRCO0FBUFgsR0FBUDtBQVNEOztBQUVELFNBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsSUFBQSxFQUFBLGFBQUEsRUFBQSxVQUFBLEVBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxZQUFBLEVBQUEsVUFBQSxFQVM2QjtBQUUzQixNQUFBLFlBQUE7QUFDQSxNQUFBLFNBQUE7O0FBRUEsTUFBSSxhQUFhLENBQWIsSUFBQSxLQUFKLFVBQUEsRUFBdUM7QUFDckMsUUFBQTtBQUFBO0FBQUEsTUFBaUI7QUFBQSxpQkFBQSxDQUFBLEtBQUEsSUFDZixxQkFEZSxxREFDZixDQURlO0FBRWhCOztBQUVELElBQUEsWUFBWSxHQUFJLGtCQUFNLEVBQU4s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QTtBQVNiLEVBQUEsSUFBSSxFQVRTLFNBQUE7QUFVYixFQUFBLEtBQUssRUFWUSxVQUFBO0FBV2IsRUFBQSxJQUFJLEVBWFMsU0FBQTtBQVliLEVBQUEsTUFBTSxFQVpPLFdBQUE7QUFhYixFQUFBLElBQUksRUFiUyxTQUFBO0FBY2IsRUFBQSxJQUFJLEVBZFMsU0FBQTtBQWViLEVBQUEsT0FBTyxFQWZNLFlBQUE7QUFnQmIsRUFBQSxPQUFPLEVBaEJNLFlBQUE7QUFpQmIsRUFBQSxXQUFXLEVBakJFLGdCQUFBO0FBa0JiLEVBQUEsUUFBUSxFQWxCSyxhQUFBO0FBbUJiLEVBQUEsR0FBRyxFQW5CVSxRQUFBO0FBb0JiLEVBQUEsR0FBRyxFQXBCVSxhQUFBO0FBc0JiLEVBQUEsTUFBTSxFQUFFLE9BQU8sQ0F0QkYsZUFzQkUsQ0F0QkY7QUF1QmIsRUFBQSxPQUFPLEVBQUUsT0FBTyxDQXZCSCxnQkF1QkcsQ0F2Qkg7QUF3QmIsRUFBQSxNQUFNLEVBQUUsT0FBTyxDQXhCRixlQXdCRSxDQXhCRjs7QUF5QmIsRUFBQSxTQUFTLEdBQUE7QUFDUCxXQUFPLFlBQVksQ0FBQSxrQkFBQSxFQUFuQixTQUFtQixDQUFuQjtBQTFCVyxHQUFBOztBQTRCYixFQUFBLElBQUksR0FBQTtBQUNGLFdBQU8sWUFBWSxDQUFBLGFBQUEsRUFBbkIsSUFBbUIsQ0FBbkI7QUFDRDs7QUE5QlksQzs7O0FBbUNmLFNBQUEsT0FBQSxDQUFBLElBQUEsRUFBdUQ7QUFDckQsU0FBTyxVQUFBLEtBQUEsRUFBMkI7QUFDaEMsV0FBTyxZQUFZLENBQUEsSUFBQSxFQUFuQixLQUFtQixDQUFuQjtBQURGLEdBQUE7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFTVCBmcm9tICcuL3R5cGVzL25vZGVzJztcbmltcG9ydCB7IE9wdGlvbiwgRGljdCB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgZGVwcmVjYXRlLCBhc3NpZ24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IExPQ0FMX0RFQlVHIH0gZnJvbSAnQGdsaW1tZXIvbG9jYWwtZGVidWctZmxhZ3MnO1xuaW1wb3J0IHsgU3RyaW5nTGl0ZXJhbCwgQm9vbGVhbkxpdGVyYWwsIE51bWJlckxpdGVyYWwgfSBmcm9tICcuL3R5cGVzL2hhbmRsZWJhcnMtYXN0JztcblxuLy8gU3RhdGVtZW50c1xuXG5leHBvcnQgdHlwZSBCdWlsZGVySGVhZCA9IHN0cmluZyB8IEFTVC5FeHByZXNzaW9uO1xuZXhwb3J0IHR5cGUgVGFnRGVzY3JpcHRvciA9IHN0cmluZyB8IHsgbmFtZTogc3RyaW5nOyBzZWxmQ2xvc2luZzogYm9vbGVhbiB9O1xuXG5mdW5jdGlvbiBidWlsZE11c3RhY2hlKFxuICBwYXRoOiBCdWlsZGVySGVhZCB8IEFTVC5MaXRlcmFsLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIHJhdz86IGJvb2xlYW4sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbixcbiAgc3RyaXA/OiBBU1QuU3RyaXBGbGFnc1xuKTogQVNULk11c3RhY2hlU3RhdGVtZW50IHtcbiAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgIHBhdGggPSBidWlsZEhlYWQocGF0aCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdNdXN0YWNoZVN0YXRlbWVudCcsXG4gICAgcGF0aCxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgZXNjYXBlZDogIXJhdyxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgICBzdHJpcDogc3RyaXAgfHwgeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQmxvY2soXG4gIHBhdGg6IEJ1aWxkZXJIZWFkLFxuICBwYXJhbXM6IE9wdGlvbjxBU1QuRXhwcmVzc2lvbltdPixcbiAgaGFzaDogT3B0aW9uPEFTVC5IYXNoPixcbiAgX2RlZmF1bHRCbG9jazogQVNULlBvc3NpYmx5RGVwcmVjYXRlZEJsb2NrLFxuICBfZWxzZUJsb2NrPzogT3B0aW9uPEFTVC5Qb3NzaWJseURlcHJlY2F0ZWRCbG9jaz4sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbixcbiAgb3BlblN0cmlwPzogQVNULlN0cmlwRmxhZ3MsXG4gIGludmVyc2VTdHJpcD86IEFTVC5TdHJpcEZsYWdzLFxuICBjbG9zZVN0cmlwPzogQVNULlN0cmlwRmxhZ3Ncbik6IEFTVC5CbG9ja1N0YXRlbWVudCB7XG4gIGxldCBkZWZhdWx0QmxvY2s6IEFTVC5CbG9jaztcbiAgbGV0IGVsc2VCbG9jazogT3B0aW9uPEFTVC5CbG9jaz4gfCB1bmRlZmluZWQ7XG5cbiAgaWYgKF9kZWZhdWx0QmxvY2sudHlwZSA9PT0gJ1RlbXBsYXRlJykge1xuICAgIGlmIChMT0NBTF9ERUJVRykge1xuICAgICAgZGVwcmVjYXRlKGBiLnByb2dyYW0gaXMgZGVwcmVjYXRlZC4gVXNlIGIuYmxvY2tJdHNlbGYgaW5zdGVhZC5gKTtcbiAgICB9XG5cbiAgICBkZWZhdWx0QmxvY2sgPSAoYXNzaWduKHt9LCBfZGVmYXVsdEJsb2NrLCB7IHR5cGU6ICdCbG9jaycgfSkgYXMgdW5rbm93bikgYXMgQVNULkJsb2NrO1xuICB9IGVsc2Uge1xuICAgIGRlZmF1bHRCbG9jayA9IF9kZWZhdWx0QmxvY2s7XG4gIH1cblxuICBpZiAoX2Vsc2VCbG9jayAhPT0gdW5kZWZpbmVkICYmIF9lbHNlQmxvY2sgIT09IG51bGwgJiYgX2Vsc2VCbG9jay50eXBlID09PSAnVGVtcGxhdGUnKSB7XG4gICAgaWYgKExPQ0FMX0RFQlVHKSB7XG4gICAgICBkZXByZWNhdGUoYGIucHJvZ3JhbSBpcyBkZXByZWNhdGVkLiBVc2UgYi5ibG9ja0l0c2VsZiBpbnN0ZWFkLmApO1xuICAgIH1cblxuICAgIGVsc2VCbG9jayA9IChhc3NpZ24oe30sIF9lbHNlQmxvY2ssIHsgdHlwZTogJ0Jsb2NrJyB9KSBhcyB1bmtub3duKSBhcyBBU1QuQmxvY2s7XG4gIH0gZWxzZSB7XG4gICAgZWxzZUJsb2NrID0gX2Vsc2VCbG9jaztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0Jsb2NrU3RhdGVtZW50JyxcbiAgICBwYXRoOiBidWlsZEhlYWQocGF0aCksXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIHByb2dyYW06IGRlZmF1bHRCbG9jayB8fCBudWxsLFxuICAgIGludmVyc2U6IGVsc2VCbG9jayB8fCBudWxsLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICAgIG9wZW5TdHJpcDogb3BlblN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGludmVyc2VTdHJpcDogaW52ZXJzZVN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGNsb3NlU3RyaXA6IGNsb3NlU3RyaXAgfHwgeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudE1vZGlmaWVyKFxuICBwYXRoOiBCdWlsZGVySGVhZCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICBsb2M/OiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPlxuKTogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCcsXG4gICAgcGF0aDogYnVpbGRIZWFkKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQYXJ0aWFsKFxuICBuYW1lOiBBU1QuUGF0aEV4cHJlc3Npb24sXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgaW5kZW50Pzogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5QYXJ0aWFsU3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnUGFydGlhbFN0YXRlbWVudCcsXG4gICAgbmFtZTogbmFtZSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgaW5kZW50OiBpbmRlbnQgfHwgJycsXG4gICAgc3RyaXA6IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbW1lbnQodmFsdWU6IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb21tZW50U3RhdGVtZW50JyxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTXVzdGFjaGVDb21tZW50KFxuICB2YWx1ZTogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQnLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRDb25jYXQoXG4gIHBhcnRzOiAoQVNULlRleHROb2RlIHwgQVNULk11c3RhY2hlU3RhdGVtZW50KVtdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5Db25jYXRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb25jYXRTdGF0ZW1lbnQnLFxuICAgIHBhcnRzOiBwYXJ0cyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuLy8gTm9kZXNcblxuZXhwb3J0IHR5cGUgRWxlbWVudEFyZ3MgPVxuICB8IFsnYXR0cnMnLCAuLi5BdHRyU2V4cFtdXVxuICB8IFsnbW9kaWZpZXJzJywgLi4uTW9kaWZpZXJTZXhwW11dXG4gIHwgWydib2R5JywgLi4uQVNULlN0YXRlbWVudFtdXVxuICB8IFsnY29tbWVudHMnLCAuLi5FbGVtZW50Q29tbWVudFtdXVxuICB8IFsnYXMnLCAuLi5zdHJpbmdbXV1cbiAgfCBbJ2xvYycsIEFTVC5Tb3VyY2VMb2NhdGlvbl07XG5cbmV4cG9ydCB0eXBlIFBhdGhTZXhwID0gc3RyaW5nIHwgWydwYXRoJywgc3RyaW5nLCBMb2NTZXhwP107XG5cbmV4cG9ydCB0eXBlIE1vZGlmaWVyU2V4cCA9XG4gIHwgc3RyaW5nXG4gIHwgW1BhdGhTZXhwLCBMb2NTZXhwP11cbiAgfCBbUGF0aFNleHAsIEFTVC5FeHByZXNzaW9uW10sIExvY1NleHA/XVxuICB8IFtQYXRoU2V4cCwgQVNULkV4cHJlc3Npb25bXSwgRGljdDxBU1QuRXhwcmVzc2lvbj4sIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgQXR0clNleHAgPSBbc3RyaW5nLCBBU1QuQXR0ck5vZGVbJ3ZhbHVlJ10gfCBzdHJpbmcsIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgTG9jU2V4cCA9IFsnbG9jJywgQVNULlNvdXJjZUxvY2F0aW9uXTtcblxuZXhwb3J0IHR5cGUgRWxlbWVudENvbW1lbnQgPSBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50IHwgQVNULlNvdXJjZUxvY2F0aW9uIHwgc3RyaW5nO1xuXG5leHBvcnQgdHlwZSBTZXhwVmFsdWUgPVxuICB8IHN0cmluZ1xuICB8IEFTVC5FeHByZXNzaW9uW11cbiAgfCBEaWN0PEFTVC5FeHByZXNzaW9uPlxuICB8IExvY1NleHBcbiAgfCBQYXRoU2V4cFxuICB8IHVuZGVmaW5lZDtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzTG9jU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgTG9jU2V4cCB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDIgJiYgdmFsdWVbMF0gPT09ICdsb2MnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQYXJhbXNTZXhwKHZhbHVlOiBTZXhwVmFsdWUpOiB2YWx1ZSBpcyBBU1QuRXhwcmVzc2lvbltdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmICFpc0xvY1NleHAodmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNIYXNoU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgRGljdDxBU1QuRXhwcmVzc2lvbj4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICBleHBlY3RUeXBlPERpY3Q8QVNULkV4cHJlc3Npb24+Pih2YWx1ZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4cGVjdFR5cGU8VD4oX2lucHV0OiBUKTogdm9pZCB7XG4gIHJldHVybjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZU1vZGlmaWVyKHNleHA6IE1vZGlmaWVyU2V4cCk6IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQge1xuICBpZiAodHlwZW9mIHNleHAgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGJ1aWxkRWxlbWVudE1vZGlmaWVyKHNleHApO1xuICB9XG5cbiAgbGV0IHBhdGg6IEFTVC5FeHByZXNzaW9uID0gbm9ybWFsaXplSGVhZChzZXhwWzBdKTtcbiAgbGV0IHBhcmFtczogQVNULkV4cHJlc3Npb25bXSB8IHVuZGVmaW5lZDtcbiAgbGV0IGhhc2g6IEFTVC5IYXNoIHwgdW5kZWZpbmVkO1xuICBsZXQgbG9jOiBBU1QuU291cmNlTG9jYXRpb24gfCBudWxsID0gbnVsbDtcblxuICBsZXQgcGFydHMgPSBzZXhwLnNsaWNlKDEpO1xuICBsZXQgbmV4dCA9IHBhcnRzLnNoaWZ0KCk7XG5cbiAgX3Byb2Nlc3M6IHtcbiAgICBpZiAoaXNQYXJhbXNTZXhwKG5leHQpKSB7XG4gICAgICBwYXJhbXMgPSBuZXh0IGFzIEFTVC5FeHByZXNzaW9uW107XG4gICAgfSBlbHNlIHtcbiAgICAgIGJyZWFrIF9wcm9jZXNzO1xuICAgIH1cblxuICAgIG5leHQgPSBwYXJ0cy5zaGlmdCgpO1xuXG4gICAgaWYgKGlzSGFzaFNleHAobmV4dCkpIHtcbiAgICAgIGhhc2ggPSBub3JtYWxpemVIYXNoKG5leHQgYXMgRGljdDxBU1QuRXhwcmVzc2lvbj4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhayBfcHJvY2VzcztcbiAgICB9XG4gIH1cblxuICBpZiAoaXNMb2NTZXhwKG5leHQpKSB7XG4gICAgbG9jID0gbmV4dFsxXTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCcsXG4gICAgcGF0aCxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVBdHRyKHNleHA6IEF0dHJTZXhwKTogQVNULkF0dHJOb2RlIHtcbiAgbGV0IG5hbWUgPSBzZXhwWzBdO1xuICBsZXQgdmFsdWU7XG5cbiAgaWYgKHR5cGVvZiBzZXhwWzFdID09PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gYnVpbGRUZXh0KHNleHBbMV0pO1xuICB9IGVsc2Uge1xuICAgIHZhbHVlID0gc2V4cFsxXTtcbiAgfVxuXG4gIGxldCBsb2MgPSBzZXhwWzJdID8gc2V4cFsyXVsxXSA6IHVuZGVmaW5lZDtcblxuICByZXR1cm4gYnVpbGRBdHRyKG5hbWUsIHZhbHVlLCBsb2MpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplSGFzaChoYXNoOiBEaWN0PEFTVC5FeHByZXNzaW9uPiwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2gge1xuICBsZXQgcGFpcnM6IEFTVC5IYXNoUGFpcltdID0gW107XG5cbiAgT2JqZWN0LmtleXMoaGFzaCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgcGFpcnMucHVzaChidWlsZFBhaXIoa2V5LCBoYXNoW2tleV0pKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGJ1aWxkSGFzaChwYWlycywgbG9jKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUhlYWQocGF0aDogUGF0aFNleHApOiBBU1QuRXhwcmVzc2lvbiB7XG4gIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gYnVpbGRIZWFkKHBhdGgpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBidWlsZEhlYWQocGF0aFsxXSwgcGF0aFsyXSAmJiBwYXRoWzJdWzFdKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRWxlbWVudE9wdGlvbnMoLi4uYXJnczogRWxlbWVudEFyZ3NbXSk6IEJ1aWxkRWxlbWVudE9wdGlvbnMge1xuICBsZXQgb3V0OiBCdWlsZEVsZW1lbnRPcHRpb25zID0ge307XG5cbiAgZm9yIChsZXQgYXJnIG9mIGFyZ3MpIHtcbiAgICBzd2l0Y2ggKGFyZ1swXSkge1xuICAgICAgY2FzZSAnYXR0cnMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmF0dHJzID0gcmVzdC5tYXAobm9ybWFsaXplQXR0cik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnbW9kaWZpZXJzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5tb2RpZmllcnMgPSByZXN0Lm1hcChub3JtYWxpemVNb2RpZmllcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnYm9keSc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQuY2hpbGRyZW4gPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2NvbW1lbnRzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG5cbiAgICAgICAgb3V0LmNvbW1lbnRzID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdhcyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQuYmxvY2tQYXJhbXMgPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2xvYyc6IHtcbiAgICAgICAgbGV0IFssIHJlc3RdID0gYXJnO1xuICAgICAgICBvdXQubG9jID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZEVsZW1lbnRPcHRpb25zIHtcbiAgYXR0cnM/OiBBU1QuQXR0ck5vZGVbXTtcbiAgbW9kaWZpZXJzPzogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudFtdO1xuICBjaGlsZHJlbj86IEFTVC5TdGF0ZW1lbnRbXTtcbiAgY29tbWVudHM/OiBFbGVtZW50Q29tbWVudFtdO1xuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdO1xuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb247XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudCh0YWc6IFRhZ0Rlc2NyaXB0b3IsIG9wdGlvbnM/OiBCdWlsZEVsZW1lbnRPcHRpb25zKTogQVNULkVsZW1lbnROb2RlO1xuZnVuY3Rpb24gYnVpbGRFbGVtZW50KHRhZzogVGFnRGVzY3JpcHRvciwgLi4ub3B0aW9uczogRWxlbWVudEFyZ3NbXSk6IEFTVC5FbGVtZW50Tm9kZTtcbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudChcbiAgdGFnOiBUYWdEZXNjcmlwdG9yLFxuICBvcHRpb25zPzogQnVpbGRFbGVtZW50T3B0aW9ucyB8IEVsZW1lbnRBcmdzLFxuICAuLi5yZXN0OiBFbGVtZW50QXJnc1tdXG4pOiBBU1QuRWxlbWVudE5vZGUge1xuICBsZXQgbm9ybWFsaXplZDogQnVpbGRFbGVtZW50T3B0aW9ucztcbiAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHtcbiAgICBub3JtYWxpemVkID0gbm9ybWFsaXplRWxlbWVudE9wdGlvbnMob3B0aW9ucywgLi4ucmVzdCk7XG4gIH0gZWxzZSB7XG4gICAgbm9ybWFsaXplZCA9IG9wdGlvbnMgfHwge307XG4gIH1cblxuICBsZXQgeyBhdHRycywgYmxvY2tQYXJhbXMsIG1vZGlmaWVycywgY29tbWVudHMsIGNoaWxkcmVuLCBsb2MgfSA9IG5vcm1hbGl6ZWQ7XG5cbiAgLy8gdGhpcyBpcyB1c2VkIGZvciBiYWNrd2FyZHMgY29tcGF0LCBwcmlvciB0byBgc2VsZkNsb3NpbmdgIGJlaW5nIHBhcnQgb2YgdGhlIEVsZW1lbnROb2RlIEFTVFxuICBsZXQgc2VsZkNsb3NpbmcgPSBmYWxzZTtcbiAgaWYgKHR5cGVvZiB0YWcgPT09ICdvYmplY3QnKSB7XG4gICAgc2VsZkNsb3NpbmcgPSB0YWcuc2VsZkNsb3Npbmc7XG4gICAgdGFnID0gdGFnLm5hbWU7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHRhZy5zbGljZSgtMSkgPT09ICcvJykge1xuICAgICAgdGFnID0gdGFnLnNsaWNlKDAsIC0xKTtcbiAgICAgIHNlbGZDbG9zaW5nID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdFbGVtZW50Tm9kZScsXG4gICAgdGFnOiB0YWcgfHwgJycsXG4gICAgc2VsZkNsb3Npbmc6IHNlbGZDbG9zaW5nLFxuICAgIGF0dHJpYnV0ZXM6IGF0dHJzIHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBtb2RpZmllcnM6IG1vZGlmaWVycyB8fCBbXSxcbiAgICBjb21tZW50czogKGNvbW1lbnRzIGFzIEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnRbXSkgfHwgW10sXG4gICAgY2hpbGRyZW46IGNoaWxkcmVuIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEF0dHIoXG4gIG5hbWU6IHN0cmluZyxcbiAgdmFsdWU6IEFTVC5BdHRyTm9kZVsndmFsdWUnXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuQXR0ck5vZGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdBdHRyTm9kZScsXG4gICAgbmFtZTogbmFtZSxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkVGV4dChjaGFycz86IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULlRleHROb2RlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGV4dE5vZGUnLFxuICAgIGNoYXJzOiBjaGFycyB8fCAnJyxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuLy8gRXhwcmVzc2lvbnNcblxuZnVuY3Rpb24gYnVpbGRTZXhwcihcbiAgcGF0aDogQnVpbGRlckhlYWQsXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuU3ViRXhwcmVzc2lvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1N1YkV4cHJlc3Npb24nLFxuICAgIHBhdGg6IGJ1aWxkSGVhZChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkSGVhZChvcmlnaW5hbDogQnVpbGRlckhlYWQsIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5FeHByZXNzaW9uIHtcbiAgaWYgKHR5cGVvZiBvcmlnaW5hbCAhPT0gJ3N0cmluZycpIHJldHVybiBvcmlnaW5hbDtcblxuICBsZXQgcGFydHMgPSBvcmlnaW5hbC5zcGxpdCgnLicpO1xuICBsZXQgdGhpc0hlYWQgPSBmYWxzZTtcblxuICBpZiAocGFydHNbMF0gPT09ICd0aGlzJykge1xuICAgIHRoaXNIZWFkID0gdHJ1ZTtcbiAgICBwYXJ0cyA9IHBhcnRzLnNsaWNlKDEpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnUGF0aEV4cHJlc3Npb24nLFxuICAgIG9yaWdpbmFsLFxuICAgIHRoaXM6IHRoaXNIZWFkLFxuICAgIHBhcnRzLFxuICAgIGRhdGE6IGZhbHNlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZExpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPihcbiAgdHlwZTogVFsndHlwZSddLFxuICB2YWx1ZTogVFsndmFsdWUnXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBUIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlLFxuICAgIHZhbHVlLFxuICAgIG9yaWdpbmFsOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfSBhcyBUO1xufVxuXG4vLyBNaXNjZWxsYW5lb3VzXG5cbmZ1bmN0aW9uIGJ1aWxkSGFzaChwYWlycz86IEFTVC5IYXNoUGFpcltdLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuSGFzaCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0hhc2gnLFxuICAgIHBhaXJzOiBwYWlycyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQYWlyKGtleTogc3RyaW5nLCB2YWx1ZTogQVNULkV4cHJlc3Npb24sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5IYXNoUGFpciB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0hhc2hQYWlyJyxcbiAgICBrZXk6IGtleSxcbiAgICB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQcm9ncmFtKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5UZW1wbGF0ZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RlbXBsYXRlJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRCbG9ja0l0c2VsZihcbiAgYm9keT86IEFTVC5TdGF0ZW1lbnRbXSxcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXSxcbiAgY2hhaW5lZCA9IGZhbHNlLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5CbG9jayB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0Jsb2NrJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBjaGFpbmVkLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFRlbXBsYXRlKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5UZW1wbGF0ZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RlbXBsYXRlJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRTb3VyY2Uoc291cmNlPzogc3RyaW5nKSB7XG4gIHJldHVybiBzb3VyY2UgfHwgbnVsbDtcbn1cblxuZnVuY3Rpb24gYnVpbGRQb3NpdGlvbihsaW5lOiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKSB7XG4gIHJldHVybiB7XG4gICAgbGluZSxcbiAgICBjb2x1bW4sXG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBTWU5USEVUSUM6IEFTVC5Tb3VyY2VMb2NhdGlvbiA9IHtcbiAgc291cmNlOiAnKHN5bnRoZXRpYyknLFxuICBzdGFydDogeyBsaW5lOiAxLCBjb2x1bW46IDAgfSxcbiAgZW5kOiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9LFxufTtcblxuZnVuY3Rpb24gYnVpbGRMb2MobG9jOiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPik6IEFTVC5Tb3VyY2VMb2NhdGlvbjtcbmZ1bmN0aW9uIGJ1aWxkTG9jKFxuICBzdGFydExpbmU6IG51bWJlcixcbiAgc3RhcnRDb2x1bW46IG51bWJlcixcbiAgZW5kTGluZT86IG51bWJlcixcbiAgZW5kQ29sdW1uPzogbnVtYmVyLFxuICBzb3VyY2U/OiBzdHJpbmdcbik6IEFTVC5Tb3VyY2VMb2NhdGlvbjtcblxuZnVuY3Rpb24gYnVpbGRMb2MoLi4uYXJnczogYW55W10pOiBBU1QuU291cmNlTG9jYXRpb24ge1xuICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHtcbiAgICBsZXQgbG9jID0gYXJnc1swXTtcblxuICAgIGlmIChsb2MgJiYgdHlwZW9mIGxvYyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNvdXJjZTogYnVpbGRTb3VyY2UobG9jLnNvdXJjZSksXG4gICAgICAgIHN0YXJ0OiBidWlsZFBvc2l0aW9uKGxvYy5zdGFydC5saW5lLCBsb2Muc3RhcnQuY29sdW1uKSxcbiAgICAgICAgZW5kOiBidWlsZFBvc2l0aW9uKGxvYy5lbmQubGluZSwgbG9jLmVuZC5jb2x1bW4pLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFNZTlRIRVRJQztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IFtzdGFydExpbmUsIHN0YXJ0Q29sdW1uLCBlbmRMaW5lLCBlbmRDb2x1bW4sIHNvdXJjZV0gPSBhcmdzO1xuICAgIHJldHVybiB7XG4gICAgICBzb3VyY2U6IGJ1aWxkU291cmNlKHNvdXJjZSksXG4gICAgICBzdGFydDogYnVpbGRQb3NpdGlvbihzdGFydExpbmUsIHN0YXJ0Q29sdW1uKSxcbiAgICAgIGVuZDogYnVpbGRQb3NpdGlvbihlbmRMaW5lLCBlbmRDb2x1bW4pLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBtdXN0YWNoZTogYnVpbGRNdXN0YWNoZSxcbiAgYmxvY2s6IGJ1aWxkQmxvY2ssXG4gIHBhcnRpYWw6IGJ1aWxkUGFydGlhbCxcbiAgY29tbWVudDogYnVpbGRDb21tZW50LFxuICBtdXN0YWNoZUNvbW1lbnQ6IGJ1aWxkTXVzdGFjaGVDb21tZW50LFxuICBlbGVtZW50OiBidWlsZEVsZW1lbnQsXG4gIGVsZW1lbnRNb2RpZmllcjogYnVpbGRFbGVtZW50TW9kaWZpZXIsXG4gIGF0dHI6IGJ1aWxkQXR0cixcbiAgdGV4dDogYnVpbGRUZXh0LFxuICBzZXhwcjogYnVpbGRTZXhwcixcbiAgcGF0aDogYnVpbGRIZWFkLFxuICBjb25jYXQ6IGJ1aWxkQ29uY2F0LFxuICBoYXNoOiBidWlsZEhhc2gsXG4gIHBhaXI6IGJ1aWxkUGFpcixcbiAgbGl0ZXJhbDogYnVpbGRMaXRlcmFsLFxuICBwcm9ncmFtOiBidWlsZFByb2dyYW0sXG4gIGJsb2NrSXRzZWxmOiBidWlsZEJsb2NrSXRzZWxmLFxuICB0ZW1wbGF0ZTogYnVpbGRUZW1wbGF0ZSxcbiAgbG9jOiBidWlsZExvYyxcbiAgcG9zOiBidWlsZFBvc2l0aW9uLFxuXG4gIHN0cmluZzogbGl0ZXJhbCgnU3RyaW5nTGl0ZXJhbCcpIGFzICh2YWx1ZTogc3RyaW5nKSA9PiBTdHJpbmdMaXRlcmFsLFxuICBib29sZWFuOiBsaXRlcmFsKCdCb29sZWFuTGl0ZXJhbCcpIGFzICh2YWx1ZTogYm9vbGVhbikgPT4gQm9vbGVhbkxpdGVyYWwsXG4gIG51bWJlcjogbGl0ZXJhbCgnTnVtYmVyTGl0ZXJhbCcpIGFzICh2YWx1ZTogbnVtYmVyKSA9PiBOdW1iZXJMaXRlcmFsLFxuICB1bmRlZmluZWQoKSB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCgnVW5kZWZpbmVkTGl0ZXJhbCcsIHVuZGVmaW5lZCk7XG4gIH0sXG4gIG51bGwoKSB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCgnTnVsbExpdGVyYWwnLCBudWxsKTtcbiAgfSxcbn07XG5cbnR5cGUgQnVpbGRMaXRlcmFsPFQgZXh0ZW5kcyBBU1QuTGl0ZXJhbD4gPSAodmFsdWU6IFRbJ3ZhbHVlJ10pID0+IFQ7XG5cbmZ1bmN0aW9uIGxpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPih0eXBlOiBUWyd0eXBlJ10pOiBCdWlsZExpdGVyYWw8VD4ge1xuICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlOiBUWyd2YWx1ZSddKTogVCB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCh0eXBlLCB2YWx1ZSk7XG4gIH07XG59XG4iXSwic291cmNlUm9vdCI6IiJ9