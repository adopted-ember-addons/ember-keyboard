function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

import { CONSTANT_TAG, isConst, isModified, ReferenceCache, value, validate } from '@glimmer/reference';
import { initializeGuid, assert } from '@glimmer/util';

import { stackAssert } from './assert';
import { APPEND_OPCODES, UpdatingOpcode } from '../../opcodes';
import { PrimitiveReference } from '../../references';

import { CONSTANTS } from '../../symbols';
APPEND_OPCODES.add(38 /* ChildScope */, function (vm) {
    return vm.pushChildScope();
});
APPEND_OPCODES.add(39 /* PopScope */, function (vm) {
    return vm.popScope();
});
APPEND_OPCODES.add(58 /* PushDynamicScope */, function (vm) {
    return vm.pushDynamicScope();
});
APPEND_OPCODES.add(59 /* PopDynamicScope */, function (vm) {
    return vm.popDynamicScope();
});
APPEND_OPCODES.add(28 /* Constant */, function (vm, _ref) {
    var other = _ref.op1;

    vm.stack.push(vm[CONSTANTS].getOther(other));
});
APPEND_OPCODES.add(29 /* Primitive */, function (vm, _ref2) {
    var primitive = _ref2.op1;

    var stack = vm.stack;
    var flag = primitive & 7; // 111
    var value = primitive >> 3;
    switch (flag) {
        case 0 /* NUMBER */:
            stack.push(value);
            break;
        case 1 /* FLOAT */:
            stack.push(vm[CONSTANTS].getNumber(value));
            break;
        case 2 /* STRING */:
            stack.push(vm[CONSTANTS].getString(value));
            break;
        case 3 /* BOOLEAN_OR_VOID */:
            stack.pushRaw(primitive);
            break;
        case 4 /* NEGATIVE */:
            stack.push(vm[CONSTANTS].getNumber(value));
            break;
        case 5 /* BIG_NUM */:
            stack.push(vm[CONSTANTS].getNumber(value));
            break;
    }
});
APPEND_OPCODES.add(30 /* PrimitiveReference */, function (vm) {
    var stack = vm.stack;
    stack.push(PrimitiveReference.create(stack.pop()));
});
APPEND_OPCODES.add(31 /* ReifyU32 */, function (vm) {
    var stack = vm.stack;
    stack.push(stack.peek().value());
});
APPEND_OPCODES.add(32 /* Dup */, function (vm, _ref3) {
    var register = _ref3.op1,
        offset = _ref3.op2;

    var position = vm.fetchValue(register) - offset;
    vm.stack.dup(position);
});
APPEND_OPCODES.add(33 /* Pop */, function (vm, _ref4) {
    var count = _ref4.op1;

    vm.stack.pop(count);
});
APPEND_OPCODES.add(34 /* Load */, function (vm, _ref5) {
    var register = _ref5.op1;

    vm.load(register);
});
APPEND_OPCODES.add(35 /* Fetch */, function (vm, _ref6) {
    var register = _ref6.op1;

    vm.fetch(register);
});
APPEND_OPCODES.add(57 /* BindDynamicScope */, function (vm, _ref7) {
    var _names = _ref7.op1;

    var names = vm[CONSTANTS].getArray(_names);
    vm.bindDynamicScope(names);
});
APPEND_OPCODES.add(68 /* Enter */, function (vm, _ref8) {
    var args = _ref8.op1;

    vm.enter(args);
});
APPEND_OPCODES.add(69 /* Exit */, function (vm) {
    vm.exit();
});
APPEND_OPCODES.add(62 /* PushSymbolTable */, function (vm, _ref9) {
    var _table = _ref9.op1;

    var stack = vm.stack;
    stack.push(vm[CONSTANTS].getTemplateMeta(_table));
});
APPEND_OPCODES.add(61 /* PushBlockScope */, function (vm) {
    var stack = vm.stack;
    stack.push(vm.scope());
});
APPEND_OPCODES.add(60 /* CompileBlock */, function (vm) {
    var stack = vm.stack;
    var block = stack.pop();
    if (block) {
        stack.push(vm.compile(block));
    } else {
        stack.push(null);
    }
}, 'jit');
APPEND_OPCODES.add(63 /* InvokeYield */, function (vm) {
    var stack = vm.stack;

    var handle = stack.pop();
    var scope = stack.pop();
    var table = stack.pop();
    false && assert(table === null || table && typeof table === 'object' && Array.isArray(table.parameters), stackAssert('Option<BlockSymbolTable>', table));

    var args = stack.pop();
    if (table === null) {
        // To balance the pop{Frame,Scope}
        vm.pushFrame();
        vm.pushScope(scope); // Could be null but it doesnt matter as it is immediatelly popped.
        return;
    }
    var invokingScope = scope;
    // If necessary, create a child scope
    {
        var locals = table.parameters;
        var localsCount = locals.length;
        if (localsCount > 0) {
            invokingScope = invokingScope.child();
            for (var i = 0; i < localsCount; i++) {
                invokingScope.bindSymbol(locals[i], args.at(i));
            }
        }
    }
    vm.pushFrame();
    vm.pushScope(invokingScope);
    vm.call(handle);
});
APPEND_OPCODES.add(64 /* JumpIf */, function (vm, _ref10) {
    var target = _ref10.op1;

    var reference = vm.stack.pop();
    if (isConst(reference)) {
        if (reference.value()) {
            vm.goto(target);
        }
    } else {
        var cache = new ReferenceCache(reference);
        if (cache.peek()) {
            vm.goto(target);
        }
        vm.updateWith(new Assert(cache));
    }
});
APPEND_OPCODES.add(65 /* JumpUnless */, function (vm, _ref11) {
    var target = _ref11.op1;

    var reference = vm.stack.pop();
    if (isConst(reference)) {
        if (!reference.value()) {
            vm.goto(target);
        }
    } else {
        var cache = new ReferenceCache(reference);
        if (!cache.peek()) {
            vm.goto(target);
        }
        vm.updateWith(new Assert(cache));
    }
});
APPEND_OPCODES.add(66 /* JumpEq */, function (vm, _ref12) {
    var target = _ref12.op1,
        comparison = _ref12.op2;

    var other = vm.stack.peek();
    if (other === comparison) {
        vm.goto(target);
    }
});
APPEND_OPCODES.add(67 /* AssertSame */, function (vm) {
    var reference = vm.stack.peek();
    if (!isConst(reference)) {
        vm.updateWith(Assert.initialize(new ReferenceCache(reference)));
    }
});
APPEND_OPCODES.add(70 /* ToBoolean */, function (vm) {
    var env = vm.env,
        stack = vm.stack;

    stack.push(env.toConditionalReference(stack.pop()));
});
export var Assert = function (_UpdatingOpcode) {
    _inherits(Assert, _UpdatingOpcode);

    function Assert(cache) {
        _classCallCheck(this, Assert);

        var _this = _possibleConstructorReturn(this, _UpdatingOpcode.call(this));

        _this.type = 'assert';
        _this.tag = cache.tag;
        _this.cache = cache;
        return _this;
    }

    Assert.initialize = function initialize(cache) {
        var assert = new Assert(cache);
        cache.peek();
        return assert;
    };

    Assert.prototype.evaluate = function evaluate(vm) {
        var cache = this.cache;

        if (isModified(cache.revalidate())) {
            vm.throw();
        }
    };

    return Assert;
}(UpdatingOpcode);
export var JumpIfNotModifiedOpcode = function (_UpdatingOpcode2) {
    _inherits(JumpIfNotModifiedOpcode, _UpdatingOpcode2);

    function JumpIfNotModifiedOpcode(tag, target) {
        _classCallCheck(this, JumpIfNotModifiedOpcode);

        var _this2 = _possibleConstructorReturn(this, _UpdatingOpcode2.call(this));

        _this2.target = target;
        _this2.type = 'jump-if-not-modified';
        _this2.tag = tag;
        _this2.lastRevision = value(tag);
        return _this2;
    }

    JumpIfNotModifiedOpcode.prototype.evaluate = function evaluate(vm) {
        var tag = this.tag,
            target = this.target,
            lastRevision = this.lastRevision;

        if (!vm.alwaysRevalidate && validate(tag, lastRevision)) {
            vm.goto(target);
        }
    };

    JumpIfNotModifiedOpcode.prototype.didModify = function didModify() {
        this.lastRevision = value(this.tag);
    };

    return JumpIfNotModifiedOpcode;
}(UpdatingOpcode);
export var DidModifyOpcode = function (_UpdatingOpcode3) {
    _inherits(DidModifyOpcode, _UpdatingOpcode3);

    function DidModifyOpcode(target) {
        _classCallCheck(this, DidModifyOpcode);

        var _this3 = _possibleConstructorReturn(this, _UpdatingOpcode3.call(this));

        _this3.target = target;
        _this3.type = 'did-modify';
        _this3.tag = CONSTANT_TAG;
        return _this3;
    }

    DidModifyOpcode.prototype.evaluate = function evaluate() {
        this.target.didModify();
    };

    return DidModifyOpcode;
}(UpdatingOpcode);
export var LabelOpcode = function () {
    function LabelOpcode(label) {
        _classCallCheck(this, LabelOpcode);

        this.tag = CONSTANT_TAG;
        this.type = 'label';
        this.label = null;
        this.prev = null;
        this.next = null;
        initializeGuid(this);
        this.label = label;
    }

    LabelOpcode.prototype.evaluate = function evaluate() {};

    LabelOpcode.prototype.inspect = function inspect() {
        return this.label + ' [' + this._guid + ']';
    };

    return LabelOpcode;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL29wY29kZXMvdm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQSxTQUFBLFlBQUEsRUFBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLGNBQUEsRUFBQSxLQUFBLEVBQUEsUUFBQSxRQUFBLG9CQUFBO0FBVUEsU0FBQSxjQUFBLEVBQUEsTUFBQSxRQUFBLGVBQUE7O0FBVUEsU0FBQSxXQUFBLFFBQUEsVUFBQTtBQUNBLFNBQUEsY0FBQSxFQUFBLGNBQUEsUUFBQSxlQUFBO0FBQ0EsU0FBQSxrQkFBQSxRQUFBLGtCQUFBOztBQUlBLFNBQUEsU0FBQSxRQUFBLGVBQUE7QUFHQSxlQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsZ0JBQUEsRUFBa0M7QUFBQSxXQUFNLEdBQXhDLGNBQXdDLEVBQU47QUFBQSxDQUFsQztBQUVBLGVBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxjQUFBLEVBQWdDO0FBQUEsV0FBTSxHQUF0QyxRQUFzQyxFQUFOO0FBQUEsQ0FBaEM7QUFFQSxlQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsc0JBQUEsRUFBd0M7QUFBQSxXQUFNLEdBQTlDLGdCQUE4QyxFQUFOO0FBQUEsQ0FBeEM7QUFFQSxlQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEscUJBQUEsRUFBdUM7QUFBQSxXQUFNLEdBQTdDLGVBQTZDLEVBQU47QUFBQSxDQUF2QztBQUVBLGVBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxjQUFBLEVBQWdDLFVBQUEsRUFBQSxRQUF1QjtBQUFBLFFBQXZCLEtBQXVCLFFBQWhCLEdBQWdCOztBQUNyRCxPQUFBLEtBQUEsQ0FBQSxJQUFBLENBQWMsR0FBQSxTQUFBLEVBQUEsUUFBQSxDQUFkLEtBQWMsQ0FBZDtBQURGLENBQUE7QUFJQSxlQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsZUFBQSxFQUFpQyxVQUFBLEVBQUEsU0FBMkI7QUFBQSxR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ZVRlbXBsYXRlLCBPcHRpb24sIE9wIH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQge1xuICBDT05TVEFOVF9UQUcsXG4gIGlzQ29uc3QsXG4gIGlzTW9kaWZpZWQsXG4gIFJlZmVyZW5jZUNhY2hlLFxuICBSZXZpc2lvbixcbiAgVGFnLFxuICB2YWx1ZSxcbiAgdmFsaWRhdGUsXG59IGZyb20gJ0BnbGltbWVyL3JlZmVyZW5jZSc7XG5pbXBvcnQgeyBpbml0aWFsaXplR3VpZCwgYXNzZXJ0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQge1xuICBDaGVja051bWJlcixcbiAgY2hlY2ssXG4gIENoZWNrSW5zdGFuY2VvZixcbiAgQ2hlY2tPcHRpb24sXG4gIENoZWNrQmxvY2tTeW1ib2xUYWJsZSxcbiAgQ2hlY2tIYW5kbGUsXG4gIENoZWNrUHJpbWl0aXZlLFxufSBmcm9tICdAZ2xpbW1lci9kZWJ1Zyc7XG5pbXBvcnQgeyBzdGFja0Fzc2VydCB9IGZyb20gJy4vYXNzZXJ0JztcbmltcG9ydCB7IEFQUEVORF9PUENPREVTLCBVcGRhdGluZ09wY29kZSB9IGZyb20gJy4uLy4uL29wY29kZXMnO1xuaW1wb3J0IHsgUHJpbWl0aXZlUmVmZXJlbmNlIH0gZnJvbSAnLi4vLi4vcmVmZXJlbmNlcyc7XG5pbXBvcnQgeyBVcGRhdGluZ1ZNIH0gZnJvbSAnLi4vLi4vdm0nO1xuaW1wb3J0IHsgVk1Bcmd1bWVudHNJbXBsIH0gZnJvbSAnLi4vLi4vdm0vYXJndW1lbnRzJztcbmltcG9ydCB7IENoZWNrUmVmZXJlbmNlLCBDaGVja1Njb3BlIH0gZnJvbSAnLi8tZGVidWctc3RyaXAnO1xuaW1wb3J0IHsgQ09OU1RBTlRTIH0gZnJvbSAnLi4vLi4vc3ltYm9scyc7XG5pbXBvcnQgeyBJbnRlcm5hbEppdFZNIH0gZnJvbSAnLi4vLi4vdm0vYXBwZW5kJztcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkNoaWxkU2NvcGUsIHZtID0+IHZtLnB1c2hDaGlsZFNjb3BlKCkpO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuUG9wU2NvcGUsIHZtID0+IHZtLnBvcFNjb3BlKCkpO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuUHVzaER5bmFtaWNTY29wZSwgdm0gPT4gdm0ucHVzaER5bmFtaWNTY29wZSgpKTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlBvcER5bmFtaWNTY29wZSwgdm0gPT4gdm0ucG9wRHluYW1pY1Njb3BlKCkpO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuQ29uc3RhbnQsICh2bSwgeyBvcDE6IG90aGVyIH0pID0+IHtcbiAgdm0uc3RhY2sucHVzaCh2bVtDT05TVEFOVFNdLmdldE90aGVyKG90aGVyKSk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlByaW1pdGl2ZSwgKHZtLCB7IG9wMTogcHJpbWl0aXZlIH0pID0+IHtcbiAgbGV0IHN0YWNrID0gdm0uc3RhY2s7XG4gIGxldCBmbGFnID0gcHJpbWl0aXZlICYgNzsgLy8gMTExXG4gIGxldCB2YWx1ZSA9IHByaW1pdGl2ZSA+PiAzO1xuXG4gIHN3aXRjaCAoZmxhZykge1xuICAgIGNhc2UgUHJpbWl0aXZlVHlwZS5OVU1CRVI6XG4gICAgICBzdGFjay5wdXNoKHZhbHVlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgUHJpbWl0aXZlVHlwZS5GTE9BVDpcbiAgICAgIHN0YWNrLnB1c2godm1bQ09OU1RBTlRTXS5nZXROdW1iZXIodmFsdWUpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgUHJpbWl0aXZlVHlwZS5TVFJJTkc6XG4gICAgICBzdGFjay5wdXNoKHZtW0NPTlNUQU5UU10uZ2V0U3RyaW5nKHZhbHVlKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFByaW1pdGl2ZVR5cGUuQk9PTEVBTl9PUl9WT0lEOlxuICAgICAgc3RhY2sucHVzaFJhdyhwcmltaXRpdmUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBQcmltaXRpdmVUeXBlLk5FR0FUSVZFOlxuICAgICAgc3RhY2sucHVzaCh2bVtDT05TVEFOVFNdLmdldE51bWJlcih2YWx1ZSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBQcmltaXRpdmVUeXBlLkJJR19OVU06XG4gICAgICBzdGFjay5wdXNoKHZtW0NPTlNUQU5UU10uZ2V0TnVtYmVyKHZhbHVlKSk7XG4gICAgICBicmVhaztcbiAgfVxufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QcmltaXRpdmVSZWZlcmVuY2UsIHZtID0+IHtcbiAgbGV0IHN0YWNrID0gdm0uc3RhY2s7XG4gIHN0YWNrLnB1c2goUHJpbWl0aXZlUmVmZXJlbmNlLmNyZWF0ZShjaGVjayhzdGFjay5wb3AoKSwgQ2hlY2tQcmltaXRpdmUpKSk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlJlaWZ5VTMyLCB2bSA9PiB7XG4gIGxldCBzdGFjayA9IHZtLnN0YWNrO1xuICBzdGFjay5wdXNoKGNoZWNrKHN0YWNrLnBlZWsoKSwgQ2hlY2tSZWZlcmVuY2UpLnZhbHVlKCkpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5EdXAsICh2bSwgeyBvcDE6IHJlZ2lzdGVyLCBvcDI6IG9mZnNldCB9KSA9PiB7XG4gIGxldCBwb3NpdGlvbiA9IGNoZWNrKHZtLmZldGNoVmFsdWUocmVnaXN0ZXIpLCBDaGVja051bWJlcikgLSBvZmZzZXQ7XG4gIHZtLnN0YWNrLmR1cChwb3NpdGlvbik7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlBvcCwgKHZtLCB7IG9wMTogY291bnQgfSkgPT4ge1xuICB2bS5zdGFjay5wb3AoY291bnQpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5Mb2FkLCAodm0sIHsgb3AxOiByZWdpc3RlciB9KSA9PiB7XG4gIHZtLmxvYWQocmVnaXN0ZXIpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5GZXRjaCwgKHZtLCB7IG9wMTogcmVnaXN0ZXIgfSkgPT4ge1xuICB2bS5mZXRjaChyZWdpc3Rlcik7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkJpbmREeW5hbWljU2NvcGUsICh2bSwgeyBvcDE6IF9uYW1lcyB9KSA9PiB7XG4gIGxldCBuYW1lcyA9IHZtW0NPTlNUQU5UU10uZ2V0QXJyYXkoX25hbWVzKTtcbiAgdm0uYmluZER5bmFtaWNTY29wZShuYW1lcyk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkVudGVyLCAodm0sIHsgb3AxOiBhcmdzIH0pID0+IHtcbiAgdm0uZW50ZXIoYXJncyk7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkV4aXQsIHZtID0+IHtcbiAgdm0uZXhpdCgpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QdXNoU3ltYm9sVGFibGUsICh2bSwgeyBvcDE6IF90YWJsZSB9KSA9PiB7XG4gIGxldCBzdGFjayA9IHZtLnN0YWNrO1xuICBzdGFjay5wdXNoKHZtW0NPTlNUQU5UU10uZ2V0VGVtcGxhdGVNZXRhKF90YWJsZSkpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QdXNoQmxvY2tTY29wZSwgdm0gPT4ge1xuICBsZXQgc3RhY2sgPSB2bS5zdGFjaztcbiAgc3RhY2sucHVzaCh2bS5zY29wZSgpKTtcbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoXG4gIE9wLkNvbXBpbGVCbG9jayxcbiAgKHZtOiBJbnRlcm5hbEppdFZNKSA9PiB7XG4gICAgbGV0IHN0YWNrID0gdm0uc3RhY2s7XG4gICAgbGV0IGJsb2NrID0gc3RhY2sucG9wPE9wdGlvbjxDb21waWxhYmxlVGVtcGxhdGU+IHwgMD4oKTtcblxuICAgIGlmIChibG9jaykge1xuICAgICAgc3RhY2sucHVzaCh2bS5jb21waWxlKGJsb2NrKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YWNrLnB1c2gobnVsbCk7XG4gICAgfVxuXG4gICAgY2hlY2sodm0uc3RhY2sucGVlaygpLCBDaGVja09wdGlvbihDaGVja051bWJlcikpO1xuICB9LFxuICAnaml0J1xuKTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkludm9rZVlpZWxkLCB2bSA9PiB7XG4gIGxldCB7IHN0YWNrIH0gPSB2bTtcblxuICBsZXQgaGFuZGxlID0gY2hlY2soc3RhY2sucG9wKCksIENoZWNrT3B0aW9uKENoZWNrSGFuZGxlKSk7XG4gIGxldCBzY29wZSA9IGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja09wdGlvbihDaGVja1Njb3BlKSk7XG4gIGxldCB0YWJsZSA9IGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja09wdGlvbihDaGVja0Jsb2NrU3ltYm9sVGFibGUpKTtcblxuICBhc3NlcnQoXG4gICAgdGFibGUgPT09IG51bGwgfHwgKHRhYmxlICYmIHR5cGVvZiB0YWJsZSA9PT0gJ29iamVjdCcgJiYgQXJyYXkuaXNBcnJheSh0YWJsZS5wYXJhbWV0ZXJzKSksXG4gICAgc3RhY2tBc3NlcnQoJ09wdGlvbjxCbG9ja1N5bWJvbFRhYmxlPicsIHRhYmxlKVxuICApO1xuXG4gIGxldCBhcmdzID0gY2hlY2soc3RhY2sucG9wKCksIENoZWNrSW5zdGFuY2VvZihWTUFyZ3VtZW50c0ltcGwpKTtcblxuICBpZiAodGFibGUgPT09IG51bGwpIHtcbiAgICAvLyBUbyBiYWxhbmNlIHRoZSBwb3B7RnJhbWUsU2NvcGV9XG4gICAgdm0ucHVzaEZyYW1lKCk7XG4gICAgdm0ucHVzaFNjb3BlKHNjb3BlISk7IC8vIENvdWxkIGJlIG51bGwgYnV0IGl0IGRvZXNudCBtYXR0ZXIgYXMgaXQgaXMgaW1tZWRpYXRlbGx5IHBvcHBlZC5cbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgaW52b2tpbmdTY29wZSA9IHNjb3BlITtcblxuICAvLyBJZiBuZWNlc3NhcnksIGNyZWF0ZSBhIGNoaWxkIHNjb3BlXG4gIHtcbiAgICBsZXQgbG9jYWxzID0gdGFibGUucGFyYW1ldGVycztcbiAgICBsZXQgbG9jYWxzQ291bnQgPSBsb2NhbHMubGVuZ3RoO1xuXG4gICAgaWYgKGxvY2Fsc0NvdW50ID4gMCkge1xuICAgICAgaW52b2tpbmdTY29wZSA9IGludm9raW5nU2NvcGUuY2hpbGQoKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbHNDb3VudDsgaSsrKSB7XG4gICAgICAgIGludm9raW5nU2NvcGUuYmluZFN5bWJvbChsb2NhbHMhW2ldLCBhcmdzLmF0KGkpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB2bS5wdXNoRnJhbWUoKTtcbiAgdm0ucHVzaFNjb3BlKGludm9raW5nU2NvcGUpO1xuICB2bS5jYWxsKGhhbmRsZSEpO1xufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5KdW1wSWYsICh2bSwgeyBvcDE6IHRhcmdldCB9KSA9PiB7XG4gIGxldCByZWZlcmVuY2UgPSBjaGVjayh2bS5zdGFjay5wb3AoKSwgQ2hlY2tSZWZlcmVuY2UpO1xuXG4gIGlmIChpc0NvbnN0KHJlZmVyZW5jZSkpIHtcbiAgICBpZiAocmVmZXJlbmNlLnZhbHVlKCkpIHtcbiAgICAgIHZtLmdvdG8odGFyZ2V0KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNhY2hlID0gbmV3IFJlZmVyZW5jZUNhY2hlKHJlZmVyZW5jZSk7XG5cbiAgICBpZiAoY2FjaGUucGVlaygpKSB7XG4gICAgICB2bS5nb3RvKHRhcmdldCk7XG4gICAgfVxuXG4gICAgdm0udXBkYXRlV2l0aChuZXcgQXNzZXJ0KGNhY2hlKSk7XG4gIH1cbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuSnVtcFVubGVzcywgKHZtLCB7IG9wMTogdGFyZ2V0IH0pID0+IHtcbiAgbGV0IHJlZmVyZW5jZSA9IGNoZWNrKHZtLnN0YWNrLnBvcCgpLCBDaGVja1JlZmVyZW5jZSk7XG5cbiAgaWYgKGlzQ29uc3QocmVmZXJlbmNlKSkge1xuICAgIGlmICghcmVmZXJlbmNlLnZhbHVlKCkpIHtcbiAgICAgIHZtLmdvdG8odGFyZ2V0KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGNhY2hlID0gbmV3IFJlZmVyZW5jZUNhY2hlKHJlZmVyZW5jZSk7XG5cbiAgICBpZiAoIWNhY2hlLnBlZWsoKSkge1xuICAgICAgdm0uZ290byh0YXJnZXQpO1xuICAgIH1cblxuICAgIHZtLnVwZGF0ZVdpdGgobmV3IEFzc2VydChjYWNoZSkpO1xuICB9XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLkp1bXBFcSwgKHZtLCB7IG9wMTogdGFyZ2V0LCBvcDI6IGNvbXBhcmlzb24gfSkgPT4ge1xuICBsZXQgb3RoZXIgPSBjaGVjayh2bS5zdGFjay5wZWVrKCksIENoZWNrTnVtYmVyKTtcblxuICBpZiAob3RoZXIgPT09IGNvbXBhcmlzb24pIHtcbiAgICB2bS5nb3RvKHRhcmdldCk7XG4gIH1cbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuQXNzZXJ0U2FtZSwgdm0gPT4ge1xuICBsZXQgcmVmZXJlbmNlID0gY2hlY2sodm0uc3RhY2sucGVlaygpLCBDaGVja1JlZmVyZW5jZSk7XG5cbiAgaWYgKCFpc0NvbnN0KHJlZmVyZW5jZSkpIHtcbiAgICB2bS51cGRhdGVXaXRoKEFzc2VydC5pbml0aWFsaXplKG5ldyBSZWZlcmVuY2VDYWNoZShyZWZlcmVuY2UpKSk7XG4gIH1cbn0pO1xuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuVG9Cb29sZWFuLCB2bSA9PiB7XG4gIGxldCB7IGVudiwgc3RhY2sgfSA9IHZtO1xuICBzdGFjay5wdXNoKGVudi50b0NvbmRpdGlvbmFsUmVmZXJlbmNlKGNoZWNrKHN0YWNrLnBvcCgpLCBDaGVja1JlZmVyZW5jZSkpKTtcbn0pO1xuXG5leHBvcnQgY2xhc3MgQXNzZXJ0IGV4dGVuZHMgVXBkYXRpbmdPcGNvZGUge1xuICBzdGF0aWMgaW5pdGlhbGl6ZShjYWNoZTogUmVmZXJlbmNlQ2FjaGU8dW5rbm93bj4pOiBBc3NlcnQge1xuICAgIGxldCBhc3NlcnQgPSBuZXcgQXNzZXJ0KGNhY2hlKTtcbiAgICBjYWNoZS5wZWVrKCk7XG4gICAgcmV0dXJuIGFzc2VydDtcbiAgfVxuXG4gIHB1YmxpYyB0eXBlID0gJ2Fzc2VydCc7XG5cbiAgcHVibGljIHRhZzogVGFnO1xuXG4gIHByaXZhdGUgY2FjaGU6IFJlZmVyZW5jZUNhY2hlPHVua25vd24+O1xuXG4gIGNvbnN0cnVjdG9yKGNhY2hlOiBSZWZlcmVuY2VDYWNoZTx1bmtub3duPikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy50YWcgPSBjYWNoZS50YWc7XG4gICAgdGhpcy5jYWNoZSA9IGNhY2hlO1xuICB9XG5cbiAgZXZhbHVhdGUodm06IFVwZGF0aW5nVk0pIHtcbiAgICBsZXQgeyBjYWNoZSB9ID0gdGhpcztcblxuICAgIGlmIChpc01vZGlmaWVkKGNhY2hlLnJldmFsaWRhdGUoKSkpIHtcbiAgICAgIHZtLnRocm93KCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBKdW1wSWZOb3RNb2RpZmllZE9wY29kZSBleHRlbmRzIFVwZGF0aW5nT3Bjb2RlIHtcbiAgcHVibGljIHR5cGUgPSAnanVtcC1pZi1ub3QtbW9kaWZpZWQnO1xuXG4gIHB1YmxpYyB0YWc6IFRhZztcblxuICBwcml2YXRlIGxhc3RSZXZpc2lvbjogUmV2aXNpb247XG5cbiAgY29uc3RydWN0b3IodGFnOiBUYWcsIHByaXZhdGUgdGFyZ2V0OiBMYWJlbE9wY29kZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy50YWcgPSB0YWc7XG4gICAgdGhpcy5sYXN0UmV2aXNpb24gPSB2YWx1ZSh0YWcpO1xuICB9XG5cbiAgZXZhbHVhdGUodm06IFVwZGF0aW5nVk0pIHtcbiAgICBsZXQgeyB0YWcsIHRhcmdldCwgbGFzdFJldmlzaW9uIH0gPSB0aGlzO1xuXG4gICAgaWYgKCF2bS5hbHdheXNSZXZhbGlkYXRlICYmIHZhbGlkYXRlKHRhZywgbGFzdFJldmlzaW9uKSkge1xuICAgICAgdm0uZ290byh0YXJnZXQpO1xuICAgIH1cbiAgfVxuXG4gIGRpZE1vZGlmeSgpIHtcbiAgICB0aGlzLmxhc3RSZXZpc2lvbiA9IHZhbHVlKHRoaXMudGFnKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGlkTW9kaWZ5T3Bjb2RlIGV4dGVuZHMgVXBkYXRpbmdPcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9ICdkaWQtbW9kaWZ5JztcblxuICBwdWJsaWMgdGFnOiBUYWc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0YXJnZXQ6IEp1bXBJZk5vdE1vZGlmaWVkT3Bjb2RlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnRhZyA9IENPTlNUQU5UX1RBRztcbiAgfVxuXG4gIGV2YWx1YXRlKCkge1xuICAgIHRoaXMudGFyZ2V0LmRpZE1vZGlmeSgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBMYWJlbE9wY29kZSBpbXBsZW1lbnRzIFVwZGF0aW5nT3Bjb2RlIHtcbiAgcHVibGljIHRhZzogVGFnID0gQ09OU1RBTlRfVEFHO1xuICBwdWJsaWMgdHlwZSA9ICdsYWJlbCc7XG4gIHB1YmxpYyBsYWJlbDogT3B0aW9uPHN0cmluZz4gPSBudWxsO1xuICBwdWJsaWMgX2d1aWQhOiBudW1iZXI7IC8vIFNldCBieSBpbml0aWFsaXplR3VpZCgpIGluIHRoZSBjb25zdHJ1Y3RvclxuXG4gIHByZXY6IGFueSA9IG51bGw7XG4gIG5leHQ6IGFueSA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IobGFiZWw6IHN0cmluZykge1xuICAgIGluaXRpYWxpemVHdWlkKHRoaXMpO1xuICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgfVxuXG4gIGV2YWx1YXRlKCkge31cblxuICBpbnNwZWN0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke3RoaXMubGFiZWx9IFske3RoaXMuX2d1aWR9XWA7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=