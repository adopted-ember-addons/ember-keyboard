{"version":3,"file":"index.js","sources":["../../../src/index.ts"],"sourcesContent":["import {\n  Namespace,\n  SerializableAttr,\n  SerializableAttrs,\n  SerializableElement,\n  SerializableNode,\n} from '@simple-dom/interface';\n\nconst ESC: {\n  [char: string]: string;\n} = {\n  '\"': '&quot;',\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n};\n\nfunction matcher(char: string) {\n  return ESC[char];\n}\n\nfunction toLowerCase(name: string) {\n  return name === 'DIV' ? 'div' : name === 'SPAN' ? 'span' : name.toLowerCase();\n}\n\nexport default class HTMLSerializer {\n  constructor(private voidMap: {\n    [tagName: string]: boolean,\n  }) {\n  }\n\n  public openTag(element: SerializableElement) {\n    return '<' + this.tagName(element) + this.attributes(element.attributes) + '>';\n  }\n\n  public closeTag(element: SerializableElement) {\n    return '</' + this.tagName(element) + '>';\n  }\n\n  public tagName(element: SerializableElement) {\n    return element.namespaceURI === Namespace.HTML ? toLowerCase(element.nodeName) : element.nodeName;\n  }\n\n  public isVoid(element: SerializableElement) {\n    return this.voidMap[element.nodeName] === true;\n  }\n\n  public attributes(attributes: SerializableAttrs) {\n    let buffer = '';\n    for (let i = 0, l = attributes.length; i < l; i++) {\n      buffer += this.attr(attributes[i]);\n    }\n    return buffer;\n  }\n\n  public escapeAttrValue(attrValue: string) {\n    if (attrValue.indexOf('&') > -1 || attrValue.indexOf('\"') > -1) {\n      return attrValue.replace(/[&\"]/g, matcher);\n    }\n\n    return attrValue;\n  }\n\n  public attr(attr: SerializableAttr) {\n    if (!attr.specified) {\n      return '';\n    }\n    if (attr.value) {\n      return ' ' + attr.name + '=\"' + this.escapeAttrValue(attr.value) + '\"';\n    }\n    return ' ' + attr.name;\n  }\n\n  public escapeText(textNodeValue: string) {\n    if (textNodeValue.indexOf('>') > -1 ||\n        textNodeValue.indexOf('<') > -1 ||\n        textNodeValue.indexOf('&') > -1\n    ) {\n      return textNodeValue.replace(/[&<>]/g, matcher);\n    }\n\n    return textNodeValue;\n  }\n\n  public text(text: SerializableNode) {\n    return this.escapeText(text.nodeValue!);\n  }\n\n  public rawHTMLSection(text: SerializableNode): string {\n    return text.nodeValue!;\n  }\n\n  public comment(comment: SerializableNode) {\n    return '<!--' + comment.nodeValue + '-->';\n  }\n\n  public serializeChildren(node: SerializableNode) {\n    let buffer = '';\n    let next = node.firstChild;\n    while (next !== null) {\n      buffer += this.serialize(next);\n      next = next.nextSibling;\n    }\n    return buffer;\n  }\n\n  public serialize(node: SerializableNode) {\n    let buffer = '';\n\n    // open\n    switch (node.nodeType) {\n      case 1:\n        buffer += this.openTag(node as SerializableElement);\n        break;\n      case 3:\n        buffer += this.text(node);\n        break;\n      case -1:\n        buffer += this.rawHTMLSection(node);\n        break;\n      case 8:\n        buffer += this.comment(node);\n        break;\n      default:\n        break;\n    }\n\n    buffer += this.serializeChildren(node);\n\n    if (node.nodeType === 1 && !this.isVoid(node as SerializableElement)) {\n      buffer += this.closeTag(node as SerializableElement);\n    }\n\n    return buffer;\n  }\n}\n"],"names":[],"mappings":"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"}