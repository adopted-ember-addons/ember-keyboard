{"version":3,"file":"index.js","sources":["../../../src/index.ts"],"sourcesContent":["import {\n  SimpleDocument,\n  SimpleDocumentFragment,\n  SimpleNode,\n} from '@simple-dom/interface';\n\nexport default class HTMLParser {\n  private parentStack: SimpleNode[];\n\n  constructor(private tokenize: Tokenizer, private document: SimpleDocument, private voidMap: IVoidMap) {\n    this.tokenize = tokenize;\n    this.document = document;\n    this.voidMap = voidMap;\n    this.parentStack = [];\n  }\n\n  public isVoid(element: SimpleNode) {\n    return this.voidMap[element.nodeName] === true;\n  }\n\n  public pushElement(token: IStartTag) {\n    const el = this.document.createElement(token.tagName);\n    const attributes = token.attributes;\n    for (let i = 0; i < attributes.length; i++) {\n      const attr = attributes[i];\n      el.setAttribute(attr[0], attr[1]);\n    }\n\n    if (this.isVoid(el)) {\n      return this.appendChild(el);\n    }\n\n    this.parentStack.push(el);\n  }\n\n  public popElement(token: IEndTag) {\n    const el = this.parentStack.pop()!;\n\n    if (el.nodeName !== token.tagName.toUpperCase()) {\n      throw new Error('unbalanced tag');\n    }\n\n    this.appendChild(el);\n  }\n\n  public appendText(token: IChars) {\n    this.appendChild(this.document.createTextNode(token.chars));\n  }\n\n  public appendComment(token: IComment) {\n    this.appendChild(this.document.createComment(token.chars));\n  }\n\n  public appendChild(node: SimpleNode) {\n    const parentNode = this.parentStack[this.parentStack.length - 1];\n    parentNode.appendChild(node);\n  }\n\n  public parse(html: string): SimpleDocumentFragment {\n    const fragment = this.document.createDocumentFragment();\n    this.parentStack.push(fragment);\n\n    const tokens = this.tokenize(html);\n    for (let i = 0, l = tokens.length; i < l; i++) {\n      const token = tokens[i];\n      switch (token.type) {\n        case 'StartTag':\n          this.pushElement(token);\n          break;\n        case 'EndTag':\n          this.popElement(token);\n          break;\n        case 'Chars':\n          this.appendText(token);\n          break;\n        case 'Comment':\n          this.appendComment(token);\n          break;\n      }\n    }\n    this.parentStack.pop();\n\n    return fragment;\n  }\n}\n\nexport interface IVoidMap {\n  [tagName: string]: boolean | undefined;\n}\n\nexport type Tokenizer = (s: string) => Token[];\n\nexport type Token = IStartTag | IEndTag | IChars | IComment;\n\nexport type Attr = [string, string];\n\nexport interface IStartTag {\n  type: 'StartTag';\n  tagName: string;\n  attributes: Attr[];\n}\n\nexport interface IEndTag {\n  type: 'EndTag';\n  tagName: string;\n}\n\nexport interface IChars {\n  type: 'Chars';\n  chars: string;\n}\n\nexport interface IComment {\n  type: 'Comment';\n  chars: string;\n}\n"],"names":[],"mappings":"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"}