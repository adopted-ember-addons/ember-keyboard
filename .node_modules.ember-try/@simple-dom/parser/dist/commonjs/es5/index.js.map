{"version":3,"file":"index.js","sources":["../../../src/index.ts"],"sourcesContent":["import {\n  SimpleDocument,\n  SimpleDocumentFragment,\n  SimpleNode,\n} from '@simple-dom/interface';\n\nexport default class HTMLParser {\n  private parentStack: SimpleNode[];\n\n  constructor(private tokenize: Tokenizer, private document: SimpleDocument, private voidMap: IVoidMap) {\n    this.tokenize = tokenize;\n    this.document = document;\n    this.voidMap = voidMap;\n    this.parentStack = [];\n  }\n\n  public isVoid(element: SimpleNode) {\n    return this.voidMap[element.nodeName] === true;\n  }\n\n  public pushElement(token: IStartTag) {\n    const el = this.document.createElement(token.tagName);\n    const attributes = token.attributes;\n    for (let i = 0; i < attributes.length; i++) {\n      const attr = attributes[i];\n      el.setAttribute(attr[0], attr[1]);\n    }\n\n    if (this.isVoid(el)) {\n      return this.appendChild(el);\n    }\n\n    this.parentStack.push(el);\n  }\n\n  public popElement(token: IEndTag) {\n    const el = this.parentStack.pop()!;\n\n    if (el.nodeName !== token.tagName.toUpperCase()) {\n      throw new Error('unbalanced tag');\n    }\n\n    this.appendChild(el);\n  }\n\n  public appendText(token: IChars) {\n    this.appendChild(this.document.createTextNode(token.chars));\n  }\n\n  public appendComment(token: IComment) {\n    this.appendChild(this.document.createComment(token.chars));\n  }\n\n  public appendChild(node: SimpleNode) {\n    const parentNode = this.parentStack[this.parentStack.length - 1];\n    parentNode.appendChild(node);\n  }\n\n  public parse(html: string): SimpleDocumentFragment {\n    const fragment = this.document.createDocumentFragment();\n    this.parentStack.push(fragment);\n\n    const tokens = this.tokenize(html);\n    for (let i = 0, l = tokens.length; i < l; i++) {\n      const token = tokens[i];\n      switch (token.type) {\n        case 'StartTag':\n          this.pushElement(token);\n          break;\n        case 'EndTag':\n          this.popElement(token);\n          break;\n        case 'Chars':\n          this.appendText(token);\n          break;\n        case 'Comment':\n          this.appendComment(token);\n          break;\n      }\n    }\n    this.parentStack.pop();\n\n    return fragment;\n  }\n}\n\nexport interface IVoidMap {\n  [tagName: string]: boolean | undefined;\n}\n\nexport type Tokenizer = (s: string) => Token[];\n\nexport type Token = IStartTag | IEndTag | IChars | IComment;\n\nexport type Attr = [string, string];\n\nexport interface IStartTag {\n  type: 'StartTag';\n  tagName: string;\n  attributes: Attr[];\n}\n\nexport interface IEndTag {\n  type: 'EndTag';\n  tagName: string;\n}\n\nexport interface IChars {\n  type: 'Chars';\n  chars: string;\n}\n\nexport interface IComment {\n  type: 'Comment';\n  chars: string;\n}\n"],"names":["let"],"mappings":";;iBASE,oBAAoB,QAAmB,EAAU,QAAwB,EAAU,OAAiB;iBAAxE,GAAR,QAAQ,CAAW;iBAAkB,GAAR,QAAQ,CAAgB;gBAAiB,GAAP,OAAO,CAAU;QAC9F,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACrB,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACrB,CAAC,OAAO,GAAG,OAAO,CAAC;QACnB,CAAC,WAAW,GAAG,EAAE,CAAC;EACvB;qBAEM,0BAAO,OAAmB;WACxB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC;EAChD;qBAEM,oCAAY,KAAgB;QAC3B,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QAChD,UAAU,GAAG,KAAK,CAAC,UAAU,CAAC;SAC/BA,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;UACzB,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;KACnC;QAEG,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;eACZ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;KAC7B;QAEG,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;EAC3B;qBAEM,kCAAW,KAAc;QACxB,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,EAAG,CAAC;QAE/B,EAAE,CAAC,QAAQ,KAAK,KAAK,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE;cACzC,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;KACnC;QAEG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;EACtB;qBAEM,kCAAW,KAAa;QACzB,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;EAC7D;qBAEM,wCAAc,KAAe;QAC9B,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;EAC5D;qBAEM,oCAAY,IAAgB;QAC3B,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;cACvD,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;EAC9B;qBAEM,wBAAM,IAAY;;;QACjB,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,sBAAsB,EAAE,CAAC;QACpD,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAE1B,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SAC9BA,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YACvC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBAChB,KAAK,CAAC,IAAI;iBACX,UAAU;sBACT,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;sBAClB;iBACH,QAAQ;sBACP,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;sBACjB;iBACH,OAAO;sBACN,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;sBACjB;iBACH,SAAS;sBACR,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;sBACpB;SACT;KACF;QACG,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC;WAEhB,QAAQ,CAAC;CACjB;;;;"}